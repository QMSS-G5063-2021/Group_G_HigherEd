---
title: "shiny_attempt1"
author: "Arielle Herman"
date: "4/18/2021"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(shiny)
library(shinydashboard)
library(tidyverse)
library(ggridges)
library(leaflet)
```


```{r}
ui <- dashboardPage(
  dashboardHeader(title = "Group G: Student Debt"),
  dashboardSidebar(
    sidebarMenu(
      menuItem("About", tabName = "about"),
      menuItem("Student Loans", tabName = "loans"),
      menuItem("What do people think?", tabName = "tweets")
    )
  ),
  dashboardBody(
    tabItems(
      tabItem(tabName = "about", class = "active",
              fluidPage(
                tags$div(
                  tags$h1("Project Motivation"),
                  "Biden's recent loan forgiveness bill has sparked much debate.  And so, we decided to investigate student
                  repayment rates and student debt over time.  Then, we look at what people are saying and where they are saying it.",
                  tags$h1("Sources"),
                  "For our project, we looked at data from the following sources:
                  (1) Scorecard, (2) Urban Institute Education Data, (3) Twitter API, and (4) Google Trends",
                  tags$h1("Team Members"),
                  "Here, we can list a little infor about ourselves",
                  tags$h3("Arielle Herman"), "Arielle's email address",
                  tags$h3("Connie Xu"), "Connie's awesome...",
                  tags$h3("Grace Li"), "Grace is awesome...",
                  tags$h3("Ariel Luo"), "Ariel is awesome..."
                )
              )),
      tabItem(tabName = "loans", class = "active",
        fluidPage(
          tags$div(
            tags$h1("Repayment Rates")),
          wellPanel(plotOutput("final")),
          wellPanel(plotOutput("violin")),
          wellPanel(plotOutput("ggridges")),
          tags$div(
            tags$h1("Student Debt")
          )
        )
      ),
      tabItem(tabName = "tweets", class = "active",
          fluidPage()
      )
    )
  )
)

server <- function(input, output) {
  library(tidyverse)
  output$final <- renderPlot({

      sc_repay %>%
      filter(years_since_entering_repay == 1, repay_rate > 0) %>%
      
      # plot
      ggplot(aes(x = repay_rate, y = fct_rev(factor(cohort_year)), fill = stat(x))) +
      scale_fill_distiller(name = "Repay Rate", palette = "greens") +
      ggridges::geom_density_ridges_gradient(scale = 2, alpha = 0.50) +
      
      # labels
      ggtitle("Proportion of University Fiscal Cohorts Whose Loan\nBalances Declined in Year One of Repayment\n") +
      ylab("Fiscal Cohort Year\n") + xlab(NULL) +
      scale_x_continuous(labels = scales::dollar_format(suffix = "%", prefix = "")) +
      scale_x_continuous(labels = scales::percent_format()) +
      ourtheme + theme(legend.position = "none")
    
  })
  
  output$violin <- renderPlot({
    
    sc_repay %>%
      pivot_longer(cols = c("repay_rate_lowincome", "repay_rate_midincome", "repay_rate_highincome"),
               names_to = "class", values_to = "rates") %>%
      filter(rates > 0) %>%
      mutate(class = factor(class, levels =
                          c("repay_rate_highincome", "repay_rate_midincome", "repay_rate_lowincome"))) %>%
      
      ggplot(aes(x = year, y = rates, group = cohort_year, fill = class)) +
      geom_violin(color = "lightgray") + facet_grid(. ~ class) +
      ggthemes::theme_tufte() + # add base theme first and then modify
      theme(panel.spacing = unit(1, "cm"),
            panel.border = element_rect(colour = "lightgray", fill=NA, size=1),
            legend.position = "bottom",
            plot.title = element_text(hjust=0.5),
            strip.text.x = element_blank(), axis.ticks = element_blank()) +
      
      ## labels
      ggtitle("Fraction Of Students In Successive Fiscal Cohorts\nWhose Loan Balances Have Declined") +
      xlab(NULL) + ylab(NULL) +
      scale_fill_viridis_d(name = "Income Range:", labels = c("High Income", "Middle Income", "Low Income")) +
      ## percents
      scale_y_continuous(labels = scales::dollar_format(suffix = "%", prefix = "")) +
      scale_y_continuous(labels = scales::percent_format())
    
  })
  
  output$ggridges <- renderPlot({
    
    sc_repay %>% mutate(opeid = as.integer(opeid)) %>%
      left_join(selectivity, by = c("opeid" = "OPEID")) %>%
      filter(years_since_entering_repay == 1) %>%
      select(repay_rate, uni_rank, cohort_year, year, opeid) %>%
      mutate(admission_half = ifelse(uni_rank %in% c("elite", "highly selective", "more selective"), 1, 0)) %>%
      na.omit() %>%
      
      filter(repay_rate > 0, uni_rank != "not selective") %>%
  
      # plot
      ggplot(aes(x = repay_rate, y = fct_rev(factor(cohort_year)), fill = uni_rank)) +
      ggridges::geom_density_ridges(scale = 2, color = "darkgray", alpha = 0.50) +
      
      # labels
      ggtitle("Proportion of University Fiscal Cohorts\nWhose Loan Balances Declined") +
      ylab("Fiscal Cohort\n") + xlab(NULL) +
      scale_fill_viridis_d(name = "Selectivity:", labels = c("Less", "Selective", "More", "Highly"), direction = 1) +
      scale_x_continuous(labels = scales::dollar_format(suffix = "%", prefix = "")) +
      scale_x_continuous(labels = scales::percent_format()) +
      ourtheme
  })
}

shinyApp(server = server, ui = ui)

```