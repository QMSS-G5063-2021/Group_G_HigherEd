---
title: "Exploratory_Visuals_03_18"
author: "Connie Xu"
date: "3/18/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages, echo=FALSE, eval=TRUE,warning=FALSE, message=FALSE}
r = getOption("repos")
r["CRAN"] = "http://cran.us.r-project.org"
options(repos = r)
# install.packages (basic)
library(dplyr)
library(tidyverse)

# install.packages (reading)
library(XML)
library(RCurl)
library(readr)
library("readxl")

# install.packages (themes)
library(ggthemes)
library(ggrepel)
library(RColorBrewer)
library(viridis)
library(hrbrthemes)
library(plotly)


# install.packages (maps)
library(RgoogleMaps)
library(ggmap)
install.packages("maps")
install.packages("tmap") # install the CRAN version
library(tmap)
install.packages('rgeos')

library(devtools)
# Let's install the development version from Github. Run
devtools::install_github("rstudio/leaflet")
```
## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r csv load, eval=TRUE, echo=FALSE, message = TRUE, warnings=FALSE}
df <- read_csv('/Users/ConnieXu/Dropbox (Business)/Spring 2021/QMSS 5063 - Data Visualization /yx2625 homework /Final Project Files/2019_College_Scorecard_Valid_Admissions_Data.csv')

#filtering as follows - lat and long 
df <- df %>% dplyr::rename(lat = LATITUDE) %>% dplyr::rename(long = LONGITUDE) %>% dplyr::rename(state = STABBR)
df <- df %>% subset(SAT_AVG !=0 | ACTCMMID!=0)
df
#recoding for admissions rates (ADM_RATE) to note selectivity level of schools
df <- df %>% dplyr::mutate(uni_rank = ifelse(ADM_RATE<0.05,'elite',ifelse(ADM_RATE<0.2,'highly selective', ifelse(ADM_RATE<0.3, 'selective',ifelse(ADM_RATE<0.7,'less selective', 'not selective')))))
colnames(df)
```
```{r dict}
# | variable                 | description                                               |
# | :----------------------- | --------------------------------------------------------- |
# | UNITID                   | IPEDS Unit ID                                             |   
# | CITY                     | description                                               |
# | state                    | state                                                     |
# | DEBT_MDN                 | The median original amount of the                         |
# |                          | loan principal upon entering repayment                    |
```

Selectivity is based on Conwell et al. (2022 exp.) [1] 

## Including Plots

```{r initial map matching, echo = TRUE, eval = TRUE, warning = FALSE, message = FALSE}

#note 
us <- map_data("state")
us_states <- as_data_frame(us) %>% dplyr::rename(state=region)
us_states

mapping=aes(x = lat, y = long)
ggplot(us,  aes(x = long, y = lat, group=group)) +
  geom_polygon(aes(), color='white') + 
  theme_ipsum() + theme(panel.grid = element_blank())+ geom_point(data = df, aes(x = long, y = lat, group=UNITID),color='orange',alpha=0.5) 

```

```{r competitiveness_student_debt, echo=TRUE,eval=TRUE, message=FALSE,warning=FALSE}
dfsub <- df %>% subset(DEBT_MDN != 'PrivacySuppressed') %>% drop_na(uni_rank) %>% drop_na(DEBT_MDN)
dfsub$uni_rank_cat = factor(dfsub$uni_rank, levels=c('elite','highly selective','selective','less selective','not selective'))

ggplot(dfsub, aes(x=uni_rank_cat,y=DEBT_MDN)) +
  geom_point(color = '#87495F',alpha=.12) +
  theme_ipsum(base_size = 12, axis_title_size = 14) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()) +
      ggtitle("Student Debt and School Tiers") +    
  labs(fill = "Selectivity", y="Student Debt", x = "School Competitiveness")

```


```{r debt_race, echo=TRUE,eval=TRUE, message=FALSE,warning=FALSE}
#dfsub %>% group_by(uni_rank) mutate(density = n()) 

m <- ggplot(dfsub, aes(x=DEBT_MDN,y=UGDS_BLACK, color = uni_rank_cat)) +
  geom_point(aes(color = uni_rank_cat), alpha=.5) +
  scale_color_manual(values=c("#F7F5F4","#786D77","#82809A","#87495F","#211622"))+
  geom_smooth(method = lm, se = FALSE)+
  theme_ipsum() +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()) +
      ggtitle("Student Debt and Racial Composition (Black Students)") +    
  labs(y="% Black Students", x = "Median Student Debt ($)")
ggplotly(m)
```
Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.  
---  
[1] - Conwell, Jordan A. and Natasha Quadlin. Forthcoming. “Race, Gender,Higher Education, and Socioeconomic Attainment: Evidence from Baby Boomers at Mid-Life.” Social Forces. DOI: 10.1093/sf/soab010.

